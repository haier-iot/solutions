
>**当前版本：** [软网关对接方案 V1.0](zh-cn/ChangeLog/sl5)   
**更新时间：** {docsify-updated} 




### 方案介绍

![整体方案图片][sl1_ztfa]  

?> U+ IOT云平台与合作方设备网关之间采用软网关认证授权的方法，互相访问交互认证的机制，保证访问安全流畅，实现海尔智能设备的配网、绑定和设备控制。  
U+ IOT为第三方开发方提供USDK、UGW开发套件，帮助快速实现服务接入和设备控制。


### 方案设计


![整体方案图片][sl5_rjgc] 


如软件构成图，说明如下：
1、	所有的交互操作由自第三方APP发起，设备配置绑定操作通过uSDK直连U+ IOT平台，智能设备控制指令通过第三方云端协议转换访问U+ IOT平台；<br/>
2、	第三方云端需要开发回调接口用于U+ IOT回调鉴权，实现云云互联；<br/>
3、	用户端账号使用第三方自有的账户体系，第三方自行维护账号的管理与授权，获取U+ IOT授权可使用云云授权的统一openId账户令牌（可以房间或路由器等为单位的设备授权，第三方可根据业务需求自行维护）；<br/>
4、	智能互联设备直连U+ IOT云平台，设备属性状态信息直接上报到U+ IOT平台；<br/>
5、	U+ IOT平台与第三方云端之间关于设备控制与信息的交互使用的UGW协议转换工具，包括控制指令的上报到U+ IOT平台或者第三方要获取设备的属性信息均通过此协议实现云云直连交互。<br/>
6、	红色部分是需要第三方实现的，包括第三方应用开发、协议转换控制、网关认证。




**网关认证**  


![整体方案图片][sl5rz]  

网关端登录U+平台的过程见流程图，说明几点：
1）CHANNELID、CHANNELKEY由合作方分配，用于合作方云验证网关请求的合法来源。
2）APPID,APPKEY 由U+云分配，用于U+云验证请求的合法来源。
3）U+云到合作方云认证主要目的是保证网关是合作方授权的，授权依据就是网关从合作方云获得的临时票据（流程图中红线部分），网关所代表的用户ID（openid），U+云将创建一个以openid为标识的“虚拟用户”，并作为后面绑定设备的用户标识。




**设备配网与绑定** 
 
![整体方案图片][sl5bd]  
1、	设备配网与发现
对于Haier智能设备发现与配网，U+ 提供uSDK作为嵌入应用
2、	设备与用户认证
设备通过路由连接会关联路由器对应的openId，形成房间单位。
用户端绑定设备需要到第三方云认证，获取对应关联openId的访问token，获取绑定此房间内设备的权限（此认证机制第三方可根据业务需求自行定义）。
3、	设备绑定
用户使用获取的openId对应的token直接调用U+ IOT平台设备绑定接口，从而绑定设备。


**设备控制**  
![整体方案图片][sl5kz] 
1、	应用端交互
第三方对其应用端数据有所有权限，应用端设备控制指令直接通过第三方应用端与第三方云平台之间定义的设备控制命令交互（第三方应用于第三方云之间的交互指令协议，可自行定义）。
2、	协议转换
第三方云平台嵌入U+ UGW协议转换工具，将第三放控制协议转换为IOT平台可识别的控制协议，从而进行设备操控。


### 方案应用

?>  方案应用于智能公寓、连锁酒店等合作方具备较强的研发能力，有自己的平台、App及网关设备（如路由器）。








<!-- 
## 功能流程 &emsp;
-->







[^-^]:常用图片注释
[sl1_ztfa]:_media/_Solutions/sl5ztfa.png  
[sl5rz]:_media/_Solutions/sl5rz.png  
[sl5bd]:_media/_Solutions/sl5bd.png  
[sl5kz]:_media/_Solutions/sl5kz.png 

[sl5_rjgc]:_media/_Solutions/sl5rjgc.png